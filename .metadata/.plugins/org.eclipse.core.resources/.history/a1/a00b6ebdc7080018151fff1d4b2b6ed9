package com.internousdev.ecsite.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import com.internousdev.ecsite.dto.SalesInfoDTO;
import com.internousdev.ecsite.util.DBConnector;

public class SalesInfoDAO {
	private DBConnector dbConnector = new DBConnector();
	private Connection connection = dbConnector.getConnection();

	public ArrayList<SalesInfoDTO> getSalesInfo(
			String buy_date_start,String buy_date_end,String product_id,String asc_desc){
		//buy_date_startからbuy_date_endの期間かつ、商品ID=product_idのリストを表示
		//asc_descで昇順か降順を指定可能

		ArrayList<SalesInfoDTO> salesInfoDTO = new ArrayList<SalesInfoDTO>();
		String sql = "SELECT "
						+ "u.regist_date "
						+ "u.product_id "
						+ "i.product_name "
						+ "u.product_count "
						+ "u.buy_total_price "
						+ "u.genka_total_price "
						+ "u.rieki "
					+ "FROM "
						+ "user_buy_item_transaction u "
					+ "LEFT JOIN "
						+ "item_info_transaction i "
					+ "ON "
						+ "u.product_id = i.product_id "
					+ "WHERE "
						+ "u.regist_date >= ? AND u.regist_date <= ? "
						+ "AND "
						+ "u.product_id = ? "
					+ "ORDER BY "
						+ "regist_date ?";

		try{
			PreparedStatement preparedStatement = connection.prepareStatement(sql);
			preparedStatement.setString(1, buy_date_start);
			preparedStatement.setString(2, buy_date_end);
			preparedStatement.setString(3, product_id);
			preparedStatement.setString(4, asc_desc);

			ResultSet resultSet = preparedStatement.executeQuery();

			while(resultSet.next()) {
				SalesInfoDTO dto = new SalesInfoDTO();
				dto.setRegist_date(resultSet.getString("regist_date"));
				dto.setProduct_id(resultSet.getString("product_id"));
				dto.setProduct_name(resultSet.getString("product_name"));
				dto.setProduct_count(resultSet.getString("product_count"));
				dto.setBuy_total_price(resultSet.getString("buy_total_price"));
				dto.setGenka_total_price(resultSet.getString("genka_total_price"));
				dto.setRieki(resultSet.getString("rieki"));
			}
	}
}
